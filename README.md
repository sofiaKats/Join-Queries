# Partitioned-Hash-Join Part 3
Κατερίνα Μπεληγιάννη Α.Μ. 1115201800126 <br />
Σοφία Κατσαούνη Α.Μ.  1115201800070 <br />
Σπύρος Κάντας Α.Μ. 1115201800059

## Πως να κάνετε compile and execute:
cd src\
cd main\ 
make\
./program

## Το πρόγραμμα

Το πρόγραμμα αρχικά διαβάζει τα αρχεία με τα Relation και τα αποθηκεύει
στη δομή Joiner ως μια λίστα από Relation. Έπειτα διαβάζει τα Queries από
αρχείο που του δίνεται και εκτελεί τα Join.

### Ενδιάμεση δομή
  Η ενδιάμεση δομή (UsedRelations ή ur) χρησιμοποιείται στην αποθήκευση τον rowid από τα
  Relations που έχουν γίνει join κατά τη διάρκεια ενός query.
  Για ενδιάμεση δομή έχουμε επιλέξει έναν πίνακα από πίνακες ακεραίων(MatchRow)
  που ο καθένας έχει όσα στοιχεία είναι και οι σχέσεις στο query που εκτελείται.
  (πχ αν συμμετέχουν 4 relations στο query, η αρχική δομή θα είναι: <br />
  -1 -1 -1 -1 <br />
  -1 -1 -1 -1 <br />
  -1 -1 -1 -1 <br />
  -1 -1 -1 -1 <br />
  ...) <br />
  Η πρώτη στήλη αναπαριστά το relation με index 0, η δεύτερη με index ένα etc.
  Κάθε φορά που θέλουμε να κάνουμε ένα join, δημιουργούμε ένα RelCol το οποίο είναι
  ένας πίνακας με Tuples όπου key=rowid, payload=value, από την αντίστοιχη στήλη του
  στο usedRelations. Αφού τελειώσει το join, επιστρέφεται ένας πίνακας(Matches) από Tuples
  και στην συνέχεια φιλτράρουμε τον πίνακα usedRelations και τον ανανεώνουμε.

### Join και ανανέωση ενδιάμεσης δομής:
  \* Μια στήλη ενός πίνακα προς join φορτώνεται στην ειδική δομή RelColumn
   που είναι ένας πίνακας με Tuples όπου key=rowid, payload=value, δομή που
   χρησιμοποιείται από την PartitionHashJoin, Filter Join, Self Join etc.
   
  \* Τα αποτελέσματα ανάλογα το join είναι είτε ένας πίνακας από tuples με τα row ids που
  ταιριάζουν(Matches) ή ένας πίνακας με τα row ids μετά από ένα φιλτράρισμα(SingleCol).
  
  <b>Διακρίνουμε τις εξής περιπτώσεις:</b>
  
  - First Join: τα αποτελέσματα\* που επιστρέφονται απλά εισχωρούνται στην ενδιάμεση δομή.

  - Left/Right Join: η αριστερή/δεξιά σχέση υπάρχει στον ενδιάμεσο πίνακα όμως η άλλη όχι,
   σε αυτή τη περίπτωση φορτώνεται\* ο πίνακας που υπάρχει στο πίνακα και ο άλλος φορτώνεται\* από
   την αρχική σχέση. Τα αποτελέσματα είναι tuples\*. Έπειτα γίνεται ανανέωση του ενδιάμεσου
   πίνακα. Για κάθε τιμή του πίνακα στην ενδιάμεση δομή γίνεται έλεγχος για το αν υπάρχει στην αντίστοιχη
   στήλη στα αποτελέσματα αν υπάρχει κρατείται και προστίθενται όλα τα αποτελέσματα με αυτή τη τιμή.
   Αν δεν υπάρχει διαγράφεται η γραμμή αυτή της ενδιάμεσης δομής.

  - Both Join: και οι δύο σχέσεις υπάρχουν στον ενδιάμεσο πίνακα άρα από τα αποτελέσματα κοιτάμε αν υπάρχουν
   και οι δύο matching τιμές μαζί στον ενδιάμεσο πίνακα αλλιώς διαγράφεται η εγγραφή.
  
  - Self/Filter Join: η σχέση φορτώνεται\* από την αρχική ή τον ενδιάμεσο πίνακα αναλόγως αν υπάρχει. Σε αυτή
   τη περίπτωση η διαφορά είναι ότι τα αποτελέσματα που επιστρέφει είναι μία στήλη(SingleCol) με row ids. Η
   ενδιάμεση δομή σκανάρεται και τα στοιχεία που υπάρχουν και στα αποτελέσματα μένουν ενώ τα άλλα διαγράφονται.


### Joiner:
  Η κλάση Joiner είναι υπεύθυνη για τη εκτέλεση πολλών join όπως τα ορίζει
  το query, τα υλοποιεί χρησιμοποιώντας τη PartitionHashJoin (βλέπε Part 1)
  ή για τις ειδικές περιπτώσεις του Filter/Self Join με δικές της συναρτήσεις.

### Relation:
  Η κλάση Relation φορτώνει και αποθηκεύει χαρακτηριστικά του πίνακα όπως size, αριθμό
  στηλών και έναν πίνακα με τις στήλες του.

### Parser:
  Ο Parser είναι υπεύθυνος για την σάρωση ανάλυση και μετατροπή αρχείου με queries στις
  αντίστοιχες ειδικές δομές Query, Predicates, Projection.

### JobScheduler
  Ο JobScheduler διαχειρίζεται τα νήματα και υλοποιεί threadPool με συνδεδεμένη λίστα Quene.
  
  <br/>
  Disclaimer: 
  Από τα queries που δίνονται στο small.work υπάρχουν κάποια που δεν τρέχουν.
  Έχουνε "φιλτράριστεί" ώστε να μην τρέξουν για να μη σταματήσει η ροή του προγράμματος.
